import{o as f,e as h,u as g,r as n,j as e,N as T,d,p,q as b,A as _,f as j,g as w,s as v}from"./index-b27c7740.js";import{R}from"./index.esm-6462b2dc.js";const N={email:"",password:"",isLoading:!1,requestStatus:{isDone:!1,message:""},errors:{email:"",password:""},rememberMe:!1,isVerified:!1};function A(l,t){switch(t.type){case"SET_EMAIL":return{...l,email:t.payload};case"SET_PASSWORD":return{...l,password:t.payload};case"SET_LOADING":return{...l,isLoading:t.payload};case"SET_REQUEST_STATUS":return{...l,requestStatus:t.payload};case"SET_ERRORS":return{...l,errors:t.payload};case"SET_REMEMBER_ME":return{...l,rememberMe:t.payload};case"SET_IS_VERIFIED":return{...l,isVerified:t.payload};default:return l}}const O=()=>{var m;const l=f(),{dispatch:t,user:u}=h(),x=((m=g().state)==null?void 0:m.path)||"/",[a,s]=n.useReducer(A,N),y=async i=>{if(i.preventDefault(),s({type:"SET_ERRORS",payload:{email:"",password:""}}),s({type:"SET_IS_VERIFIED",payload:!1}),s({type:"SET_REQUEST_STATUS",payload:{isDone:!0,message:""}}),S())try{s({type:"SET_LOADING",payload:!0});const r={email:a.email,password:a.password},o=await j.post(`${w}/api/auth/login`,r);t({type:"SET_TOKEN",payload:o.data.data.token}),t({type:"SET_IS_LOGGED_IN",state:!0}),a.rememberMe&&v.set("token",o.data.data.token,{expires:30,path:"/"}),l(x,{replace:!0})}catch(r){r.response?r.response.status===401?(s({type:"SET_REQUEST_STATUS",payload:{isDone:!0,message:r.response.data.message}}),r.response.data.message==="Account must be verified."&&s({type:"SET_IS_VERIFIED",payload:!0})):s({type:"SET_REQUEST_STATUS",payload:{isDone:!0,message:r.response.data.message}}):s({type:"SET_REQUEST_STATUS",payload:{isDone:!0,message:"Please check your internet connection"}})}finally{s({type:"SET_LOADING",payload:!1})}},c=i=>{const{name:r,value:o}=i.target;switch(r){case"email":s({type:"SET_EMAIL",payload:o});break;case"password":s({type:"SET_PASSWORD",payload:o});break}},E=i=>{s({type:"SET_REMEMBER_ME",payload:i.target.checked})},S=()=>{let i={email:"",password:""};return i.password=a.password?"":"This field is required",i.email=a.email===""?"This field is required":/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(a.email)?"":"email format is not valid",s({type:"SET_ERRORS",payload:i}),Object.values(i).every(r=>r==="")};return n.useEffect(()=>{window.scrollTo(0,0)},[]),Object.keys(u).length!==0?e.jsx(T,{to:"/",replace:!0}):e.jsxs(n.Fragment,{children:[e.jsx("div",{className:"text-center mb-10",children:e.jsx("h2",{className:"font-bold text-3xl text-gray-900 capitalize",children:"login"})}),a.requestStatus.isDone?e.jsx("p",{className:"text-red-600 text-center text-lg",children:a.requestStatus.message}):null,a.isVerified?e.jsx(d,{state:{email:a.email},to:"/account/login/verify",className:"text-red-600 block text-center hover:underline text-lg",children:"verify your account"}):null,e.jsxs("form",{onSubmit:y,children:[e.jsx(p,{label:"email",placeholder:"example@example.com",value:a.email,onChange:c,isPassword:!1,Icon:e.jsx(b,{}),error:a.errors.email}),e.jsx(p,{label:"password",placeholder:"************",value:a.password,onChange:c,isPassword:!0,Icon:e.jsx(R,{}),error:a.errors.password}),e.jsxs("div",{className:"flex justify-between px-3 items-center mb-5 -mx-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{name:"remember-me",id:"remember-me",type:"checkbox",value:a.rememberMe,onChange:E,className:"rounded-sm text-primary focus:ring-0"}),e.jsx("label",{htmlFor:"remember-me",className:"capitalize ml-2 font-semibold px-1",children:"remember me"})]}),e.jsx("div",{children:e.jsx(d,{to:"/account/forget-password",className:"w-full flex hover:text-primary justify-center items-center",children:"forget password?"})})]}),e.jsxs("div",{className:"flex flex-col justify-center items-center -mx-3",children:[e.jsx("div",{}),e.jsx("div",{className:"w-full px-3 mb-5",children:e.jsx("button",{type:"submit",disabled:a.isLoading,className:`flex justify-center items-center w-full max-w-xs text-2xl uppercase mx-auto bg-primary hover:bg-primary/80 disabled:cursor-wait\r
               disabled:bg-primary/80 transition-all duration-300 hover:scale-105 disabled:hover:scale-100 text-white rounded-lg px-3 py-2 font-semibold`,children:a.isLoading?e.jsx(_,{className:"text-4xl text-center animate-spin"}):"login"})}),e.jsx("div",{className:"flex hover:text-primary -mx-3",children:e.jsx(d,{to:"/account/register",children:"create new account"})})]})]})]})};export{O as default};
